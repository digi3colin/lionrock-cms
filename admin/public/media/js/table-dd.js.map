{"version":3,"file":"table-dd.js","names":["fn","document","readyState","addEventListener","table","getElementById","tbody","querySelector","currRow","dragElem","mouseDownX","mouseDownY","mouseX","mouseY","mouseDrag","init","bindMouse","event","button","target","getTargetRow","addDraggableRow","classList","add","coords","getMouseCoords","x","y","moveRow","remove","tableBody","removeChild","swapRow","row","index","currIndex","Array","from","children","indexOf","row1","row2","insertBefore","style","transform","dPos","getBoundingClientRect","currStartY","currEndY","height","rows","getRows","i","length","rowElem","rowSize","rowStartY","rowEndY","isIntersecting","Math","abs","cloneNode","getStyle","background","oldTD","newTD","width","padding","margin","appendChild","tPos","bottom","left","dispatchEvent","MouseEvent","view","window","cancelable","bubbles","querySelectorAll","elemName","tagName","toLowerCase","closest","clientX","clientY","styleName","compStyle","getComputedStyle","min0","max0","min1","max1","max","min"],"sources":["../../../public_source/media/js/table-dd.js"],"sourcesContent":["\"use strict\";\n\n(fn => document.readyState !== 'loading' ? fn() : document.addEventListener('DOMContentLoaded', fn))(() => {\n  \"use strict\";\n\n  const table = document.getElementById('table');\n  const tbody = table.querySelector('tbody');\n  let currRow = null,\n      dragElem = null,\n      mouseDownX = 0,\n      mouseDownY = 0,\n      mouseX = 0,\n      mouseY = 0,\n      mouseDrag = false;\n\n  function init() {\n    bindMouse();\n  }\n\n  function bindMouse() {\n    document.addEventListener('mousedown', event => {\n      if (event.button !== 0) return true;\n      let target = getTargetRow(event.target);\n\n      if (target) {\n        currRow = target;\n        addDraggableRow(target);\n        currRow.classList.add('is-dragging');\n        let coords = getMouseCoords(event);\n        mouseDownX = coords.x;\n        mouseDownY = coords.y;\n        mouseDrag = true;\n      }\n    });\n    document.addEventListener('mousemove', event => {\n      if (!mouseDrag) return;\n      let coords = getMouseCoords(event);\n      mouseX = 0; //coords.x - mouseDownX;\n\n      mouseY = coords.y - mouseDownY;\n      moveRow(mouseX, mouseY);\n    });\n    document.addEventListener('mouseup', event => {\n      if (!mouseDrag) return;\n      currRow.classList.remove('is-dragging');\n      const tableBody = table.querySelector('tbody');\n      tableBody.removeChild(dragElem);\n      dragElem = null;\n      mouseDrag = false;\n    });\n  }\n\n  function swapRow(row, index) {\n    let currIndex = Array.from(tbody.children).indexOf(currRow),\n        row1 = currIndex > index ? currRow : row,\n        row2 = currIndex > index ? row : currRow;\n    tbody.insertBefore(row1, row2);\n  }\n\n  function moveRow(x, y) {\n    dragElem.style.transform = \"translate3d(\" + x + \"px, \" + y + \"px, 0)\";\n    let dPos = dragElem.getBoundingClientRect(),\n        currStartY = dPos.y,\n        currEndY = currStartY + dPos.height,\n        rows = getRows();\n\n    for (var i = 0; i < rows.length; i++) {\n      let rowElem = rows[i],\n          rowSize = rowElem.getBoundingClientRect(),\n          rowStartY = rowSize.y,\n          rowEndY = rowStartY + rowSize.height;\n\n      if (currRow !== rowElem && isIntersecting(currStartY, currEndY, rowStartY, rowEndY)) {\n        if (Math.abs(currStartY - rowStartY) < rowSize.height / 2) swapRow(rowElem, i);\n      }\n    }\n  }\n\n  function addDraggableRow(target) {\n    dragElem = target.cloneNode(true);\n    dragElem.classList.add('draggable-table__drag');\n    dragElem.style.height = getStyle(target, 'height');\n    dragElem.style.background = getStyle(target, 'backgroundColor');\n\n    for (let i = 0; i < target.children.length; i++) {\n      let oldTD = target.children[i],\n          newTD = dragElem.children[i];\n      newTD.style.width = getStyle(oldTD, 'width');\n      newTD.style.height = getStyle(oldTD, 'height');\n      newTD.style.padding = getStyle(oldTD, 'padding');\n      newTD.style.margin = getStyle(oldTD, 'margin');\n    }\n\n    const tableBody = table.querySelector('tbody');\n    tableBody.appendChild(dragElem);\n    let tPos = target.getBoundingClientRect(),\n        dPos = dragElem.getBoundingClientRect();\n    dragElem.style.bottom = dPos.y - tPos.y - tPos.height + \"px\";\n    dragElem.style.left = \"-1px\";\n    document.dispatchEvent(new MouseEvent('mousemove', {\n      view: window,\n      cancelable: true,\n      bubbles: true\n    }));\n  }\n\n  function getRows() {\n    return table.querySelectorAll('tbody tr');\n  }\n\n  function getTargetRow(target) {\n    let elemName = target.tagName.toLowerCase();\n    if (elemName === 'tr') return target;\n    if (elemName === 'td') return target.closest('tr');\n  }\n\n  function getMouseCoords(event) {\n    return {\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  function getStyle(target, styleName) {\n    let compStyle = getComputedStyle(target),\n        style = compStyle[styleName];\n    return style ? style : null;\n  }\n\n  function isIntersecting(min0, max0, min1, max1) {\n    return Math.max(min0, max0) >= Math.min(min1, max1) && Math.min(min0, max0) <= Math.max(min1, max1);\n  }\n\n  init();\n});\n//# sourceMappingURL=table-dd.js.map"],"mappings":"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"}