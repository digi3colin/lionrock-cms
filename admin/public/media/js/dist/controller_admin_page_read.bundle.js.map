{"version":3,"file":"controller_admin_page_read.bundle.js","mappings":"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","sources":["webpack:///../../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack:///../../../../node_modules/@babel/runtime/helpers/esm/createClass.js","webpack:///./classes/Scrollback.mjs","webpack:///./classes/helper/Page.mjs","webpack:///../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///./classes/MediaPort.js","webpack:///./entry/admin/pages/read.js"],"sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default class ScrollBack{\n  static saveScroll(){\n    sessionStorage.setItem('adminPageScroll', window.scrollY.toString() );\n    sessionStorage.setItem('adminPageExit', window.location.href.split('?')[0] );\n  }\n\n  static restoreScroll(){\n    const lastScroll = sessionStorage.getItem('adminPageScroll');\n    if(lastScroll){\n      if(sessionStorage.getItem('adminPageExit') !== window.location.href.split('?')[0] )return;\n      window.scrollTo({top: parseInt(lastScroll)});\n    }\n  }\n\n  static saveOnSubmit(form){\n    form.addEventListener('submit', () => {\n      this.saveScroll();\n    });\n  }\n}","export default class HelperPage{\n  static enableAutoSave(){\n    const cbAutoSave = document.getElementById('autosave');\n    if(!cbAutoSave)return;\n\n    cbAutoSave.addEventListener('change', evt => {\n      evt.currentTarget.form.submit();\n    })\n  }\n\n  static enablePointers(){\n    const domRoot = document.querySelector('html');\n    const language = domRoot.getAttribute('lang');\n    const refPages = document.querySelectorAll('select.ref-pages');\n    refPages.forEach(it => {\n      const pageType = it.getAttribute('data-pagetype');\n\n      fetch(`/admin/api/pages/${pageType}?language=${language}`).then(res => {\n        res.json().then(obj =>{\n          console.log(obj);\n        })\n      })\n      console.log(it);\n    });\n\n    const refPageItems = document.querySelectorAll('select.ref-page-items');\n    refPageItems.forEach(it => {\n      const sourceOptions = it.innerHTML;\n      const value = it.getAttribute('data-value');\n      const pageType = it.getAttribute('data-pagetype');\n      const itemName = it.getAttribute('data-item');\n      const url = `/admin/api/page-items/${pageType}/${itemName}?language=${language}`;\n      it.innerHTML = `<option value=\"\">Loading...</option>`;\n      fetch(url).then(res =>{\n        res.json().then(pages =>{\n          const options = [sourceOptions];\n          pages.forEach(page => {\n            options.push(`<optgroup label=\"${page.name}\">`)\n            page.items.forEach(item => {\n              options.push(`<option value=\"${item.id}\" ${(item.id.toString() === value) ? 'selected' : '' }>${item.name}</option>`);\n            })\n            options.push(`</optgroup>`);\n          })\n          it.innerHTML = options.join('/n');\n        });\n      });\n    });\n  }\n\n  static enableBlock(){\n    const elAddBlock = document.getElementById('add-block');\n    if(elAddBlock){\n      const blockSelect = elAddBlock.querySelector('select');\n      const blockBtn = elAddBlock.querySelector('a');\n\n      blockSelect.addEventListener('change', () =>{\n        blockBtn.setAttribute('href', blockBtn.getAttribute('data-link').replace('[block_name]', blockSelect.value))\n      })\n    }\n  }\n\n  static addPageTag(pageId, tagId, cb){\n    fetch(`/admin/api/page/${pageId}/tag/${tagId}`, {\n      credentials: 'include',\n      method: \"POST\",\n    }).then(res => res.json().then(fsa => {\n      console.log(fsa);\n      if(fsa.payload.success !== true)return;\n      cb(fsa.payload);\n    }))\n  }\n\n  static enablePageTag(){\n    document.querySelectorAll('.page-tag-form').forEach(el => {\n      const pageId = el.getAttribute('data-page');\n      const inputField = el.querySelector('.tag-add-input');\n      const pageTagList = el.querySelector('.page-tag-list');\n\n      const removePageTag = evt => {\n        const element = evt.currentTarget;\n\n        fetch(`/admin/api/page_tag/${element.getAttribute('data-id')}`, {\n          credentials: 'include',\n          method: \"DELETE\",\n        }).then(res => res.json().then(obj => {\n          console.log(obj);\n          element.remove();\n        }))\n      }\n\n      el.querySelector('.toggle-input-tag').addEventListener('click', element => {\n        if(inputField.classList.contains('visually-hidden')){\n          inputField.classList.remove('visually-hidden');\n        }else{\n          inputField.classList.add('visually-hidden');\n        }\n      })\n\n      el.querySelectorAll('.page-tag.badge').forEach(tagElement => {\n        tagElement.addEventListener('click', removePageTag);\n      })\n\n      inputField.addEventListener('change', () => {\n        const option = el.querySelector(`option[value=\"${inputField.value}\"]`);\n        if(!option)return;\n        const tag_id = option.getAttribute('data-id');\n        const tag_value = option.getAttribute('data-value');\n        const tag_name = option.getAttribute('data-name');\n\n        this.addPageTag(pageId, tag_id, (payload) => {\n          const newTag = document.createElement('span');\n          newTag.value = `${tag_value} ( ${tag_name} )`;\n          newTag.setAttribute('data-id', payload.id);\n          newTag.setAttribute('role', \"button\");\n          newTag.classList.add(\"badge\", \"bg-primary\", \"rounded-pill\");\n          newTag.innerHTML = `${tag_value} <i class=\"fas fa-times\"></i>`;\n          pageTagList.appendChild(newTag);\n          pageTagList.appendChild(document.createTextNode(' '));\n          inputField.value = '';\n          newTag.addEventListener('click', removePageTag);\n        })\n      });\n    })\n  }\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","export default class MediaPort{\n  static enableUpload(uploadURL, options = {}){\n    const opt = {\n      apiKey: 'api',\n      dir: 'cms',\n      selector: '.page-field-upload',\n      selectorFile : 'input[type=\"file\"]',\n      callback      : (error, element, result) => {\n        if(error)throw error;\n        const uploadedFile = result.files[0];\n        const txtInput = element.querySelector('.page-field-upload-text');\n        const preview = element.querySelector('.preview img')\n        txtInput.value = `/${uploadedFile}`;\n        if(preview)preview.src = `${options.previewUrl||'https://www.example.com'}${uploadedFile}`;\n      },\n      ...options\n    }\n\n    const uploadFields = document.querySelectorAll(opt.selector);\n\n    uploadFields.forEach(el => {\n      const fileInput = el.querySelector(opt.selectorFile);\n      fileInput.addEventListener('change', () => {\n        const formData = new FormData();\n        formData.append('file', fileInput.files[0]);\n        formData.append('dir', opt.dir);\n        formData.append('api-key', opt.apiKey);\n\n        fetch(uploadURL, { // Your POST endpoint\n          method: 'POST',\n          body: formData,\n          mode: 'cors', // no-cors, cors, *same-origin\n        }).then(\n          response => {\n            response.json().then(obj => {\n              const uploadedFile = obj.files[0];\n              if(!uploadedFile)return opt.callback(new Error('upload error'), el, uploadedFile);\n              opt.callback(null, el, obj);\n            });\n          }\n        ).catch(\n          error => opt.callback(error, el, null)\n        );\n      }, false);\n    })\n  }\n}","import ScrollBack from '../../../classes/Scrollback.mjs';\nimport HelperPage from \"../../../classes/helper/Page.mjs\";\nimport MediaPort from \"../../../classes/MediaPort\";\n\nScrollBack.restoreScroll();\nScrollBack.saveOnSubmit(document.getElementById('main-form'));\n\nHelperPage.enableAutoSave();\n//HelperPage.enablePointers();\n//HelperPage.enableBlock();\nHelperPage.enablePageTag();\n\nconst apiKey = {\n  'www2-admin.occasionspr.com' : 'occadmintest',\n  'www-admin.occasionspr.com' : 'occadmin',\n}\n\nconst uploadURL = {\n  'www2-admin.occasionspr.com' : 'https://mediaport.dappod.com/upload',\n  'www-admin.occasionspr.com' : 'https://mediaport.dappod.com/upload',\n}\n\nMediaPort.enableUpload(uploadURL[window.location.hostname] || '/admin/upload', {\n  apiKey : apiKey[window.location.hostname] || 'occadmin',\n  dir : 'cms',\n  previewUrl : window.location.origin + '/'\n});\n\ntinymce.init({\n  selector: 'textarea',\n  menubar: '',\n  branding: false,\n  width: '100%',\n  plugins: 'code',\n  toolbar: 'undo redo bold italic removeformat code',\n  paste_as_text: true\n}).then();"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","ScrollBack","sessionStorage","setItem","window","scrollY","toString","location","href","split","lastScroll","getItem","scrollTo","top","parseInt","form","addEventListener","saveScroll","HelperPage","cbAutoSave","document","getElementById","evt","currentTarget","submit","language","querySelector","getAttribute","querySelectorAll","forEach","it","pageType","fetch","then","res","json","obj","console","log","sourceOptions","innerHTML","value","itemName","url","pages","options","page","push","name","items","item","id","join","elAddBlock","blockSelect","blockBtn","setAttribute","replace","pageId","tagId","cb","credentials","method","fsa","payload","success","el","inputField","pageTagList","removePageTag","element","remove","classList","contains","add","tagElement","option","tag_id","tag_value","tag_name","addPageTag","newTag","createElement","appendChild","createTextNode","_defineProperty","MediaPort","uploadURL","opt","apiKey","dir","selector","selectorFile","callback","error","result","uploadedFile","files","txtInput","preview","src","previewUrl","uploadFields","fileInput","formData","FormData","append","body","mode","response","Error","restoreScroll","saveOnSubmit","enableAutoSave","enablePageTag","enableUpload","hostname","origin","tinymce","init","menubar","branding","width","plugins","toolbar","paste_as_text"],"sourceRoot":""}